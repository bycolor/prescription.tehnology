<!DOCTYPE html>
<html>
	<head>
		<title>Prescription Technology</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/reset.css" media="screen" />
		<link rel="stylesheet" type="text/css" href="css/responsive.gs.24col.css" media="screen" />
		<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
		<link rel="stylesheet" type="text/css" href="css/styles.css" media="screen" />
		<script type="text/javascript" src="cordova.js"></script>
		<script type="text/javascript" src="js/respond.min.js"></script>
		<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="js/custom.jquery.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,800,700italic" rel="stylesheet" type="text/css" />
	</head>
	<body id="login-page">
		<!-- Preloader -->
		<div id="page-preloader">
			<img class="preloader" src="img/loading.gif" alt=""/>
		</div>
		
		<div class="container wrap">
			<div class="row gutters">
				<div class="col span_24">
					<a href="/" id="logo" title="Prescription Technology - Order Form" /><img src="img/logo_PT.png" alt="" /></a>
					<a href="/" id="nav-toggle" title="Prescription Technology - Order Form Menu" />Menu</a>
				</div>
			</div>
		</div>

        <div id="response-holder"></div>
    </div>
</div>
<script type="text/javascript">
			function PowerUp() {
				var oLocalStorage = new classLocalStorage();
				var $logOff = $('#logoff');
				var $responseHolder = $('#response-holder');
				var $pagePreloader = $('#page-preloader');

				$logOff.on('touchstart click', function(e) {
					e.preventDefault();

					$pagePreloader.show();
					var jqxhr = $.ajax({
						type: 'GET',
						url: $logOff.prop('href')
					}).fail(function(response) {
						// Failure
						var json = $.parseJSON(response);
						var status = json.status;
						var message = json.message;

						var messages = ''
										+ '<p class="alert error">status: ' + status + '</p>'
										+ '<p class="alert error">message: ' + message + '</p>'
										;
						$responseHolder.append(messages).show();
						oLocalStorage.ClearSession();
					}).done(function(response) {
						// Success
						try {
							var json = $.parseJSON(response);
							var status = json.status;
							var message = json.message;
							var user = json.user;
							//console.log('response: ' + response);
							//console.log('JSON.stringify(status): ' + JSON.stringify(status));
							//console.log('JSON.stringify(message): ' + JSON.stringify(message));
							//messages = ''
											//+ '<p class="alert success force-wrap">status: ' + status + '</p>'
											//+ '<p class="alert success force-wrap">message: ' + message + '</p>'
											//+ '<p class="alert success force-wrap">user: ' + JSON.stringify(user) + '</p>'
											//+ '<p class="alert success force-wrap">user.username: ' + user.username + '</p>'
											//+ '<p class="alert success force-wrap">user.username: ' + user[username] + '</p>'
											//+ '<p class="alert success force-wrap">user.firstname: ' + user.firstname + '</p>'
											;
							if (status == '1') {
								oLocalStorage.ClearSession();
								//console.log('JSON.stringify(user): ' + JSON.stringify(user));
								//window.location.href = 'file:///android_asset/www/acasa.html';
								window.location.href = 'conectare.html';
							} else {
								// Error - Saving local storage data
								$responseHolder.hide().html('<p class="alert error">' + message + '</p>').fadeIn('fast');
							}
						} catch (err) {
							// Error - Misc
							messages = '<p class="alert error">Call succceeded, but parsing got an error: ' + err.message + '.</p>';
							$responseHolder.hide().html(messages).fadeIn('fast');
						}
						return false;
					}).always(function() {
						//alert( "complete" );
						$pagePreloader.fadeOut();
					});
					return false;
				});
				
				$('#nav-toggle').on('touchstart click', function(e){
					e.preventDefault();
					console.log('opening side panel');
					prescription.onDrawerAction("open");
					//prescription.sendMessage("LOGGEDIN");
					prescription.sendMessage("OPENCART");
				});
			};
			$(function() {
				document.addEventListener("deviceready", PowerUp, true);       
			});


</script>
</body>
</html>