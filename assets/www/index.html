<!DOCTYPE html>
<html>
<head>
    <title>Prescription Technology</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" type="text/css" href="css/reset.css" media="screen"/>
    <link rel="stylesheet" type="text/css" href="css/responsive.gs.24col.css" media="screen"/>
    <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/styles.css" media="screen"/>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic,600,600italic,700,800,700italic"
          rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
</head>
<body id="index">
<!-- Preloader -->
<div id="page-preloader">
    <img class="preloader" src="img/loading.gif" alt=""/>
</div>

<div class="container wrap">
    <div class="row gutters">
        <div class="col span_24">
            <a href="/" id="logo" title="Prescription Technology - Order Form"><img src="img/logo_PT.png" alt=""/></a>
            <a href="/" id="nav-toggle" title="Prescription Technology - Order Form Menu">Menu</a>
        </div>
    </div>
</div>

<div class="container wrap">
    <h1>Index page</h1>

    <div class="col span_24">
        <form id="products-form" class="hide" action="https://prescription.technology/ws/prescription.asp"
              method="post">
            <input type="hidden" id="action" name="action" value="2"/>

            <div class="row gutters">
                <div id="products-list" class="col span_24">
                    <div class="clonable">
                        <div class="col span_24">
                            <div class="col span_12">
                                <p class="autoupdate" data-term="productname"></p>
                            </div>
                            <div class="col span_12">
                                <p class="autoupdate" data-term="productprice"></p>
                            </div>
                        </div>
                        <div class="col span_24">
                            <a href="#" class="btn btn-big has-icon add-to-cart-btn">Add to cart</a>
                        </div>
                        <hr/>
                    </div>
                    <!--<select id="product-list"></select>-->
                </div>
                <div class="col span_24">
                    <div class="col span_24">
                        <a id="orders-history" href="orders_history.html" class="btn btn-big has-icon">Orders
                            History</a>
                    </div>
                    <div class="col span_24">
                        <a id="messages" href="messages.html" class="btn btn-big has-icon">Messages</a>
                    </div>
                </div>
            </div>
        </form>
        <div id="response-holder">

        </div>
        <div id="errors-holder"></div>
    </div>
</div>

<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/respond.min.js"></script>
<script type="text/javascript" src="js/custom.jquery.js"></script>
<script type="text/javascript">
        var oLocalStorage = new classLocalStorage();
        function PowerUp() {
            var oLocalStorage = new classLocalStorage();
            var $responseHolder = $('#response-holder');
            var $pagePreloader = $('#page-preloader');
            var $productsForm = $('#products-form');
            var $productList = $('#product-list');
            var $errorPlaceHolder = $('#errors-holder');
            //console.log(isFromCache());
            prescription.cart().ClearCartContent(); //debug: clear cart content
            if (!isFromCache()) {
                $pagePreloader.show();
                $productsForm[0].autoSubmit(function (products) {
                    if (typeof products !== "undefined" && products.length > 0) {
                        for (var i = 0 ; i < products.length; i++) {
                            var product = products[i];
                            var $clone = $productList.find('.clonable').clone();
                            $clone.attr('id', 'product-' + product.productid);
                            oLocalStorage.UpdatePageElements(product, $clone);
                            var $ebtn = $clone.find('a.add-to-cart-btn');

                            $ebtn.attr('data-id', product.productid);
                            $ebtn.attr('data-max', product.productmaxquantity);
                            $ebtn.attr('data-price', product.productprice);
                            $clone.removeClass('clonable');
                            $productList.append($clone);
                            /*
                            var $option = $('<option></option>');
                            $option.attr('id', 'item-' + product.productid);
                            $option.attr('value', product.productid);
                            $option.attr('data-max', product.productmaxquantity);
                            $option.attr('data-price', product.productprice);
                            $option.html(product.productname);
                            $productList.append($option);
                            */
                        }
                    }
                    $pagePreloader.hide();
                    $productsForm.removeClass('hide');
                });
            }
            $(document).on('click', '.add-to-cart-btn', function (e) {
                e.preventDefault();
                var pid = $(this).data('id');
                var $pholder = $('#product-' + pid);
                var name = $pholder.find('[data-term=productname]').text();
                var price = $pholder.find('[data-term=productprice]').text();
                var obj = {
                    productid: pid,
                    productname: name,
                    productprice: "&pound; " + price,
                    productmaxquantity: maxqt,
                    productsubtotal: "&pound; " + price
                };
                var str = JSON.stringify(obj);
                prescription.cart().addToCart(str);
                prescription.sendMessage(static.updateCartEventName, static.left_menu_view_Id);
                prescription.OnDrawerAction("open");
                /*
                var $selectedProduct = $productList.find(':selected');
                if (typeof $selectedProduct !== "undefined") {
                    var price = typeof $selectedProduct.data('price') !== "undefined" ? $selectedProduct.data('price') : 0;
                    var maxqt = typeof $selectedProduct.data('max') !== "undefined" ? $selectedProduct.data('max') : 1;
                    var obj = {
                        productid: $selectedProduct.val(),
                        productname: $selectedProduct.text(),
                        productprice: "&pound; " + price,
                        productmaxquantity: maxqt,
                        productsubtotal: "&pound; " + price
                    };
                    var str = JSON.stringify(obj);
                    prescription.cart().addToCart(str);
                    prescription.sendMessage(static.updateCartEventName, static.left_menu_view_Id);
                    prescription.OnDrawerAction("open");
                } else {
                    $errorPlaceHolder.addErrorMessage("Please select at least one product!");
                }
                */
            });
        };
        document.addEventListener("deviceready", PowerUp, true);



</script>
</body>
</html>